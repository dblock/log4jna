version: 2.0.{build}
os: Windows Server 2012
branches:
  only:
  - maven-conversion
install:
  - cmd: gpg --version
  - cmd: DIR %APPVEYOR_BUILD_FOLDER%
  - nuget install secure-file -ExcludeVersion
  - secure-file\tools\secure-file -decrypt %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc.enc -secret %secret%
  - secure-file\tools\secure-file -decrypt %APPVEYOR_BUILD_FOLDER%\build\Maven\secring.gpg.asc.enc -secret %secret%
  - gpg --import %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc
  - gpg --import %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc

environment:
  secret:
    secure: Z851+sNOAoEP/lr/3hGjRjC+SlaO19wPqPAYGZFEgfY=  
# For build and test we need to pass -Djna.nosys=true  to avoid exception:
# java.lang.UnsatisfiedLinkError: Can't obtain updateLastError method for class com.sun.jna.Native
build_script:
   - gpg --list-keys
#  - mvn clean install -B -Djna.nosys=true

test_script:
#build_script:
#  - mvn clean install -B -Djna.nosys=true

#test_script:
#  - mvn clean -B test -Djna.nosys=true 
cache:
  - '%USERPROFILE%\.gnupg -> %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc.enc'
#  - C:\maven\apache-maven-3.3.9
#  - '%USERPROFILE%\.m2'
