version: 2.0.{build}
os: Windows Server 2012
branches:
  only:
  - maven-conversion
install:

  -cmd: echo %SECURE_FILE_DIR%
  
  # Install secure-file if not present
  - ps: |
     if (!(Test-Path -Path $env:SECURE_FILE_DIR )) {
        nuget install secure-file -ExcludeVersion -o C:\
     }
      
  - cmd: DIR %SECURE_FILE_DIR%
  - '%SECURE_FILE_DIR%\tools\secure-file -decrypt %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc.enc -secret %secret%'
  - '%SECURE_FILE_DIR%\tools\secure-file -decrypt %APPVEYOR_BUILD_FOLDER%\build\Maven\secring.gpg.asc.enc -secret %secret%'
  - gpg --import %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc
  - gpg --import %APPVEYOR_BUILD_FOLDER%\build\Maven\secring.gpg.asc

environment:
  
  SECURE_FILE_DIR: C:\secure_file
  
  secret:
    secure: Z851+sNOAoEP/lr/3hGjRjC+SlaO19wPqPAYGZFEgfY=  
# For build and test we need to pass -Djna.nosys=true  to avoid exception:
# java.lang.UnsatisfiedLinkError: Can't obtain updateLastError method for class com.sun.jna.Native
build_script:
  - gpg --list-keys
  - gpg --list-secret-keys
# - mvn clean install -B -Djna.nosys=true

test_script:
#build_script:
#  - mvn clean install -B -Djna.nosys=true

#test_script:
#  - mvn clean -B test -Djna.nosys=true 
cache:
  - '%secure_file_dir%'
  - '%USERPROFILE%\.gnupg -> %APPVEYOR_BUILD_FOLDER%\build\Maven\pubring.gpg.asc.enc'
#  - C:\maven\apache-maven-3.3.9
#  - '%USERPROFILE%\.m2'
